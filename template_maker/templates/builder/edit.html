{% extends "builder/main.html" %}

{% block css %}
<!-- Include Font Awesome. -->
<link href="{{ url_for('static', filename='lib/froala/css/font-awesome.min.css') }}" rel="stylesheet" type="text/css" />

<!-- Include Editor style. -->
<link href="{{ url_for('static', filename='lib/froala/css/froala_editor.min.css') }}" rel="stylesheet" type="text/css" />
<link href="{{ url_for('static', filename='lib/froala/css/froala_style.min.css') }}" rel="stylesheet" type="text/css" />
{% endblock %}

{% block subcontent %}

<div>
  <div class="row">
    <div class="col-sm-3">
      <h3>{{ template.title }}</h3>
      <hr>
      {% include 'builder/sections/section-sidebar.html' %}
    </div>
    <div class="col-sm-9">
      <div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
      {% for section in sections %}
        <div class="panel panel-default">
          <div class="panel-heading" >
            <span class="panel-title" role="tab" id="heading{{ section.id }}" data-toggle="collapse" href="#collapse{{ section.id }}" aria-expanded="false" aria-controls="collapse{{ section.id }}">
              <span class="glyphicon {% if section.id == current_section.id %}glyphicon-pencil{% else %}glyphicon glyphicon-arrow-down js-glyphicon{% endif %}" aria-hidden="true"></span>
              <strong>{{ section.title }}</strong>
              <span>{{ section.description }}</span>
            </span>
            <a class="pull-right" href="{{ url_for('builder.edit_section', template_id=template.id, section_id=section.id) }}">Edit</a>
          </div>

          {% if section.id == current_section.id %}
          <div id="collapse{{ section.id }}" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="heading{{ section.id }}">
            <div class="panel-body">
              {% if section.section_type == 'text' %}
                {% include 'builder/sections/text-section.html' %}
              {% elif section.section_type == 'fixed_text' %}
                {% include 'builder/sections/text-section.html' %}
              {% endif %}
            </div>
          </div>
          {% else %}
          <div id="collapse{{ section.id }}" class="panel-collapse collapse" role="tabpanel" aria-labelledby="heading{{ section.id }}">
            <div class="panel-body">
              {{ section.text | safe }}
            </div>
          </div>
          {% endif %}

        </div>
      {% endfor %}
      </div>


      <a href="{{ url_for('builder.publish_template', template_id=template.id) }}" class="btn btn-primary">Preview Template</a>
    </div>
  </div>
</div>

{% endblock %}

{% block javascripts %}
  {% if current_section.section_type in ['text', 'fixed_text'] %}
    <script src="{{ url_for('static', filename='lib/froala/js/froala_editor.min.js') }}"></script>
    <!-- Include IE8 JS. -->
    <!--[if lt IE 9]>
      <script src="{{ url_for('static', filename='lib/froala/js/froala_editor_ie8.min.js') }}></script>
    <![endif]-->
    <script id="sectionText" type="section-text">
      {{ current_section.text | safe }}
    </script>
    <script type="text/javascript" src="{{ url_for('static', filename='js/froalaInit.js') }}"></script>
  {% endif %}
{% endblock %}