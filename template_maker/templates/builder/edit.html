{% extends "builder/main.html" %}

{% block css %}
<!-- Include Font Awesome. -->
<link href="{{ url_for('static', filename='lib/froala/css/font-awesome.min.css') }}" rel="stylesheet" type="text/css" />

<!-- Include Editor style. -->
<link href="{{ url_for('static', filename='lib/froala/css/froala_editor.min.css') }}" rel="stylesheet" type="text/css" />
<link href="{{ url_for('static', filename='lib/froala/css/froala_style.min.css') }}" rel="stylesheet" type="text/css" />
{% endblock %}

{% block subcontent %}

<div>
  <div class="row">
    <div class="col-sm-3">
      <h3>{{ template.title }}</h3>
      <hr>
      {% include 'builder/sections/section-sidebar.html' %}
    </div>
    <div class="col-sm-9">

      {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
        <div class="alert {{ category }} alert-dismissible flashed-alert fade in" role="alert">
          <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          {{ message }}
        </div>
        {% endfor %}
      {% endif %}
      {% endwith %}

      <div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">

      {% if sections | length == 0 %}
        <div class="well">
          <span class="lead">
            There don't seem to be any sections in this template! Why not choose a section from the left to get started.
          </span>
        </div>
      {% else %}

        {% for section in sections %}

        {% if section.id == current_section.id %}
          {% include "builder/sections/editable-section.html" %}
        {% else %}
          {% include "builder/sections/view-section.html" %}
        {% endif %}

        {% endfor %}
      </div>
      <a href="{{ url_for('builder.publish_template', template_id=template.id) }}" class="btn btn-primary pull-right">Preview Template</a>

      {% endif %}

    </div>
  </div>
</div>

{% endblock %}

{% block javascripts %}
  {% if current_section.section_type in ['text', 'fixed_text'] %}
    <script src="{{ url_for('static', filename='lib/froala/js/froala_editor.min.js') }}"></script>
    <!-- Include IE8 JS. -->
    <!--[if lt IE 9]>
      <script src="{{ url_for('static', filename='lib/froala/js/froala_editor_ie8.min.js') }}></script>
    <![endif]-->
    <script id="sectionText" type="section-text">
      {{ current_section.text | safe }}
    </script>
    <script type="text/javascript" src="{{ url_for('static', filename='js/froalaInit.js') }}"></script>
  {% endif %}
  <script type="text/javascript" src="{{ url_for('static', filename='js/builderAccordion.js') }}"></script>
{% endblock %}
